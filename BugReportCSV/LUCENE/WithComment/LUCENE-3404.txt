testIWondiskfull checkindex failure
looks like charlie cron created a corrupt index on disk full.. can t reproduce with the seed on this machine i can try on that VM with the same environment and see if i have better luck. junit Testsuite org.apache.lucene.index.TestIndexWriterOnDiskFull junit Testcase testAddIndexOnDiskFull org.apache.lucene.index.TestIndexWriterOnDiskFull Caused an ERROR junit CheckIndex failed junit java.lang.RuntimeException CheckIndex failed junit at org.apache.lucene.util. TestUtil.checkIndex TestUtil.java 162 junit at org.apache.lucene.util. TestUtil.checkIndex TestUtil.java 148 junit at org.apache.lucene.store.MockDirectoryWrapper.close MockDirectoryWrapper.java 485 junit at org.apache.lucene.index.TestIndexWriterOnDiskFull.testAddIndexOnDiskFull TestIndexWriterOnDiskFull.java 429 junit at org.apache.lucene.util.LuceneTestCaseRunner.runChild LuceneTestCaseRunner.java 148 junit at org.apache.lucene.util.LuceneTestCaseRunner.runChild LuceneTestCaseRunner.java 50 junit junit junit Tests run 4 Failures 0 Errors 1 Time elapsed 0.515 sec junit junit Standard Output junit CheckIndex failed junit Segments file segments 2 numSegments 26 version 4.0 format FORMAT 4 0 Lucene 4.0 junit 1 of 26 name m docCount 38 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.004 junit diagnostics optimize false mergeFactor 10 os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source merge os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 77 terms 114 terms docs pairs 114 tokens junit test stored fields.......OK 76 total field count avg 2 fields per doc junit test term vectors........OK 1 total vector count avg 0.026 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 2 of 26 name l docCount 2 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 5 terms 6 terms docs pairs 6 tokens junit test stored fields.......OK 4 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 3 of 26 name n docCount 2 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound false junit hasProx true junit numFiles 9 junit size MB 0 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 5 terms 6 terms docs pairs 6 tokens junit test stored fields.......OK 4 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 4 of 26 name o docCount 2 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 5 terms 6 terms docs pairs 6 tokens junit test stored fields.......OK 4 total field count avg 2 fields per doc junit test term vectors........OK 1 total vector count avg 0.5 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 5 of 26 name p docCount 2 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 5 terms 6 terms docs pairs 6 tokens junit test stored fields.......OK 4 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 6 of 26 name q docCount 2 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 5 terms 6 terms docs pairs 6 tokens junit test stored fields.......OK 4 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 7 of 26 name r docCount 2 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound false junit hasProx true junit numFiles 9 junit size MB 0 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 5 terms 6 terms docs pairs 6 tokens junit test stored fields.......OK 4 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 8 of 26 name s docCount 2 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 5 terms 6 terms docs pairs 6 tokens junit test stored fields.......OK 4 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 9 of 26 name t docCount 2 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound false junit hasProx true junit numFiles 9 junit size MB 0 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 5 terms 6 terms docs pairs 6 tokens junit test stored fields.......OK 4 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 10 of 26 name u docCount 2 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 5 terms 6 terms docs pairs 6 tokens junit test stored fields.......OK 4 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 11 of 26 name v docCount 1 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 3 terms 3 terms docs pairs 3 tokens junit test stored fields.......OK 2 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 12 of 26 name w docCount 25 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound false junit hasProx true junit numFiles 12 junit size MB 0.003 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 51 terms 75 terms docs pairs 75 tokens junit test stored fields.......OK 50 total field count avg 2 fields per doc junit test term vectors........OK 4 total vector count avg 0.16 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 13 of 26 name x docCount 25 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound false junit hasProx true junit numFiles 12 junit size MB 0.003 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 51 terms 75 terms docs pairs 75 tokens junit test stored fields.......OK 50 total field count avg 2 fields per doc junit test term vectors........OK 2 total vector count avg 0.08 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 14 of 26 name y docCount 25 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.003 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 51 terms 75 terms docs pairs 75 tokens junit test stored fields.......OK 50 total field count avg 2 fields per doc junit test term vectors........OK 7 total vector count avg 0.28 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 15 of 26 name z docCount 6 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 13 terms 18 terms docs pairs 18 tokens junit test stored fields.......OK 12 total field count avg 2 fields per doc junit test term vectors........OK 2 total vector count avg 0.333 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 16 of 26 name 10 docCount 6 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit FAILED junit WARNING fixIndex would remove reference to this segment full exception junit java.io.IOException Read past EOF junit at org.apache.lucene.store.RAMInputStream.switchCurrentBuffer RAMInputStream.java 92 junit at org.apache.lucene.store.RAMInputStream.readByte RAMInputStream.java 65 junit at org.apache.lucene.store.DataInput.readInt DataInput.java 73 junit at org.apache.lucene.store.MockIndexInputWrapper.readInt MockIndexInputWrapper.java 123 junit at org.apache.lucene.store.CompoundFileDirectory.readEntries CompoundFileDirectory.java 102 junit at org.apache.lucene.store.CompoundFileDirectory. init CompoundFileDirectory.java 67 junit at org.apache.lucene.index.SegmentInfo.loadFieldInfos SegmentInfo.java 269 junit at org.apache.lucene.index.SegmentInfo.getFieldInfos SegmentInfo.java 325 junit at org.apache.lucene.index.SegmentInfo.getHasProx SegmentInfo.java 582 junit at org.apache.lucene.index.CheckIndex.checkIndex CheckIndex.java 496 junit at org.apache.lucene.util. TestUtil.checkIndex TestUtil.java 158 junit at org.apache.lucene.util. TestUtil.checkIndex TestUtil.java 148 junit at org.apache.lucene.store.MockDirectoryWrapper.close MockDirectoryWrapper.java 485 junit at org.apache.lucene.index.TestIndexWriterOnDiskFull.testAddIndexOnDiskFull TestIndexWriterOnDiskFull.java 429 junit at sun.reflect.NativeMethodAccessorImpl.invoke0 Native Method junit at sun.reflect.NativeMethodAccessorImpl.invoke NativeMethodAccessorImpl.java 39 junit at sun.reflect.DelegatingMethodAccessorImpl.invoke DelegatingMethodAccessorImpl.java 25 junit at java.lang.reflect.Method.invoke Method.java 597 junit at org.junit.runners.model.FrameworkMethod 1.runReflectiveCall FrameworkMethod.java 44 junit at org.junit.internal.runners.model.ReflectiveCallable.run ReflectiveCallable.java 15 junit at org.junit.runners.model.FrameworkMethod.invokeExplosively FrameworkMethod.java 41 junit at org.junit.internal.runners.statements.InvokeMethod.evaluate InvokeMethod.java 21 junit at org.junit.rules.TestWatchman 1.evaluate TestWatchman.java 48 junit at org.junit.internal.runners.statements.RunBefores.evaluate RunBefores.java 29 junit at org.junit.internal.runners.statements.RunAfters.evaluate RunAfters.java 31 junit at org.junit.runners.BlockJUnit4ClassRunner.runChild BlockJUnit4ClassRunner.java 76 junit at org.apache.lucene.util.LuceneTestCaseRunner.runChild LuceneTestCaseRunner.java 148 junit at org.apache.lucene.util.LuceneTestCaseRunner.runChild LuceneTestCaseRunner.java 50 junit at org.junit.runners.ParentRunner 3.run ParentRunner.java 194 junit at org.junit.runners.ParentRunner 1.schedule ParentRunner.java 53 junit at org.junit.runners.ParentRunner.runChildren ParentRunner.java 191 junit at org.junit.runners.ParentRunner.access 000 ParentRunner.java 42 junit at org.junit.runners.ParentRunner 2.evaluate ParentRunner.java 185 junit at org.junit.internal.runners.statements.RunBefores.evaluate RunBefores.java 29 junit at org.junit.internal.runners.statements.RunAfters.evaluate RunAfters.java 31 junit at org.junit.runners.ParentRunner.run ParentRunner.java 236 junit at junit.framework.JUnit4TestAdapter.run JUnit4TestAdapter.java 40 junit at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run JUnitTestRunner.java 420 junit at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch JUnitTestRunner.java 911 junit at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main JUnitTestRunner.java 746 junit junit 17 of 26 name 11 docCount 6 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 13 terms 18 terms docs pairs 18 tokens junit test stored fields.......OK 12 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 18 of 26 name 12 docCount 6 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 13 terms 18 terms docs pairs 18 tokens junit test stored fields.......OK 12 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 19 of 26 name 13 docCount 1 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 3 terms 3 terms docs pairs 3 tokens junit test stored fields.......OK 2 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 20 of 26 name 14 docCount 4 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 9 terms 12 terms docs pairs 12 tokens junit test stored fields.......OK 8 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 21 of 26 name 15 docCount 4 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 9 terms 12 terms docs pairs 12 tokens junit test stored fields.......OK 8 total field count avg 2 fields per doc junit test term vectors........OK 1 total vector count avg 0.25 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 22 of 26 name 16 docCount 4 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 9 terms 12 terms docs pairs 12 tokens junit test stored fields.......OK 8 total field count avg 2 fields per doc junit test term vectors........OK 1 total vector count avg 0.25 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 23 of 26 name 17 docCount 4 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 9 terms 12 terms docs pairs 12 tokens junit test stored fields.......OK 8 total field count avg 2 fields per doc junit test term vectors........OK 1 total vector count avg 0.25 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 24 of 26 name 18 docCount 4 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics optimize false mergeFactor 1 os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source merge os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 9 terms 12 terms docs pairs 12 tokens junit test stored fields.......OK 8 total field count avg 2 fields per doc junit test term vectors........OK 1 total vector count avg 0.25 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 25 of 26 name 19 docCount 4 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0.001 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 9 terms 12 terms docs pairs 12 tokens junit test stored fields.......OK 8 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit 26 of 26 name 1a docCount 1 junit codec SegmentCodecs codecs Standard minBlockSize 67 maxBlockSize 135 SimpleText provider RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 junit compound true junit hasProx true junit numFiles 2 junit size MB 0 junit diagnostics os.version 2.6.32-24-generic os Linux lucene.version 4.0-SNAPSHOT source flush os.arch i386 java.version 1.6.0 20 java.vendor Oracle Corporation junit no deletions junit test open reader.........OK junit test fields..............OK 2 fields junit test field norms.........OK 2 fields junit test terms freq prox...OK 3 terms 3 terms docs pairs 3 tokens junit test stored fields.......OK 2 total field count avg 2 fields per doc junit test term vectors........OK 0 total vector count avg 0 term freq vector fields per doc junit test DocValues........OK 0 total doc Count Num DocValues Fields 0 junit junit WARNING 1 broken segments containing 6 documents detected junit junit junit Standard Error junit NOTE reproduce with ant test -Dtestcase TestIndexWriterOnDiskFull -Dtestmethod testAddIndexOnDiskFull -Dtests.seed -701a2f1db029fc68 -69e1d358129f80b8 -37e6e82cd17aa6e9 -Dtests.multiplier 3 junit NOTE test params are codec RandomCodecProvider id SimpleText field MockSep f MockRandom content Standard minBlockSize 67 maxBlockSize 135 locale ar SD timezone Brazil DeNoronha junit NOTE all tests run in this JVM junit TestNumericTokenStream TestFlex TestFlushByRamOrCountsPolicy TestIndexReaderCloneNorms TestIndexWriterDelete TestIndexWriterMerging TestIndexWriterOnDiskFull junit NOTE Linux 2.6.32-24-generic i386 Oracle Corporation 1.6.0 20 32-bit cpus 1 threads 1 free 22929736 total 96641024 junit junit TEST org.apache.lucene.index.TestIndexWriterOnDiskFull FAILED At revision 1162298. OK seed reproduces if you svn up -r 1162298 first OK I found the problem Ð it s because we are incorrectly passing true instead of false as the first arg to IOUtils.closeSafely in IW.copySegmentIntoCFS. This then suppresses an exception that corrupted the .cfe file being written thus making the rest of the code think everything is fine... I looked at all other places we call this method and there were a few other cases. I think this is trappy Ð instead of a boolean I think we should rename IOUtils.closeSafely into 2 methods closeSafelyDuringExc and closeSafely. Patch fixing the issue and the other places where we incorrectly passed true. But I want to do another iter with the renaming... Actually I ll commit this fix first and open a separate issue about not using a boolean here. I think this is trappy Ð instead of a boolean I think we should rename IOUtils.closeSafely into 2 methods closeSafelyDuringExc and closeSafely. Sounds like the other one should be called .closeUnsafely... Fixed. 3.x didn t have any problems just test-only changes backported.
