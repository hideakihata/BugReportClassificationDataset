DatabaseJournal assigns same revision id to different revisions
Running a transaction that updates multiple workspaces e.g. a versioning operation will fail in DatabaseJournal because every individual update will ultimately be assigned the same revision id. An indication of this failure when e.g. using Oracle as backend for journaling will look as follows java.sql.SQLException ORA-00001 unique constraint JOURNAL IDX violated Êat oracle.jdbc.dbaccess.DBError.throwSqlException DBError.java 134 Êat oracle.jdbc.ttc7.TTIoer.processError TTIoer.java 289 Êat oracle.jdbc.ttc7.Oall7.receive Oall7.java 590 Êat oracle.jdbc.ttc7.TTC7Protocol.doOall7 TTC7Protocol.java 1973 Êat oracle.jdbc.ttc7.TTC7Protocol.executeFetch TTC7Protocol.java 977 Êat oracle.jdbc.driver.OracleStatement.executeNonQuery OracleStatement.java 2205 Êat oracle.jdbc.driver.OracleStatement.doExecuteOther OracleStatement.java 2064 Êat oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout OracleStatement.java 2989 Êat oracle.jdbc.driver.OraclePreparedStatement.executeUpdate OraclePreparedStatement.java 658 Êat oracle.jdbc.driver.OraclePreparedStatement.execute OraclePreparedStatement.java 736 Êat org.apache.jackrabbit.core.journal.DatabaseJournal.append DatabaseJournal.java 293 Ê... 24 more This bug has been reported by Rafa Kwiecie .Fixed by saving away the locked revision number in the record being appended. Fixed in revision 533019.Issue only fixed in trunk.Leaving Fix Version as is. This probably caused the fix to pass unnoticed.Merged to the 1.3 branch in revision 577847.
